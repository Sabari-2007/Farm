<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FarmEasy</title>
  <link rel="icon" type="image/jpeg" href="Assets/cropped-Gemini_Generated_Image_1z5ej21z5ej21z5e-removebg-preview.png">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      display: flex;
      background: #fffaf0;
      color: #333;
    }

    .sidebar {
      width: 220px;
      background: #2c3e50;
      color: white;
      height: 100vh;
      padding-top: 20px;
      display: flex;
      flex-direction: column;
      position: fixed;
    }

    .sidebar h2 {
      text-align: center;
      margin-bottom: 30px;
    }

    .sidebar button {
      background: none;
      border: none;
      color: white;
      padding: 12px 20px;
      text-align: left;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s, padding-left 0.3s;
      margin: 4px 0;
      border-radius: 6px;
    }

    .sidebar button:hover {
      background: #27ae60;
      padding-left: 30px;
    }

    .content {
      margin-left: 240px;
      flex: 1;
      padding: 20px;
    }

    header {
      background: linear-gradient(to right, #34495e, rgb(166, 173, 209));
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      border-radius: 8px;
    }

    .center {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 30px;
      gap: 20px;
    }
    button {
      background: #34495e;
      color: white;
      padding: 10px 20px;
      border: none;
      margin: 10px;
      cursor: pointer;
      border-radius: 8px;
      font-size: 18px;
    }
    button:hover { background: #2c3e50; }
    .back-btn { background: #1ABC9C; margin-bottom: 15px; }
    .hidden { display: none; }
    .search-bar {
      width: 60%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin: 20px auto;
      display: block;
    }
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px;
    }
    .product-card {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .product-card img { max-width: 100%; height: 120px; object-fit: cover; }
    .price { color: #34495e; font-weight: bold; margin-top: 10px; }
    .seller-container { padding: 20px; position: relative; }
    .plus-btn {
      font-size: 40px;
      background: #34495e;
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      cursor: pointer;
    }
    .seller-listings { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; }
    .seller-card {
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 8px;
      background: #fff;
      width: 150px;
      text-align: center;
    }
    .form-popup {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      max-width: 400px;
      margin: auto;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
    }
    .form-popup input, .form-popup select {
      width: 100%; margin: 10px 0; padding: 8px;
      border: 1px solid #ccc; border-radius: 6px;
    }
    .footer-text { font-size: 14px; color: red; margin-top: 10px; text-align: center; }
    .top-bar {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin: 10px 20px;
      position: relative;
      align-items: center;
    }
    #successPopup, #centerConfirmPopup {
      position: fixed; 
      background: #1ABC9C; 
      color: white;
      padding: 10px 20px; 
      border-radius: 6px;
      display: none; 
      z-index: 1100;
    }
    #successPopup { top: 20px; right: 20px; }
    #centerConfirmPopup {
      top: 50%; left: 50%; transform: translate(-50%, -50%);
      font-size: 20px; font-weight: bold;
    }
    #categoriesDropdown, #ordersDropdown {
      display: none;
      position: absolute;
      top: 42px;
      left: 0;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 8px;
      z-index: 2000;
      width: 240px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.12);
    }
    #categoriesDropdown button, #ordersDropdown button {
      display: block;
      width: 100%;
      margin: 6px 0;
      padding: 8px;
      background: rgb(166, 173, 209);
      border: none;
      border-radius: 5px;
      cursor: pointer;
      text-align: left;
    }
    #categoriesDropdown button.selected, #ordersDropdown button.selected { background: #1ABC9C; }
    #categoriesDropdown button:hover, #ordersDropdown button:hover { background: #1ABC9C; }

    #sideOrderPanel {
      display: none;
      position: fixed;
      right: 0;
      top: 80px;
      width: 260px;
      height: calc(100vh - 120px);
      background: #fff;
      border-left: 1px solid #ccc;
      padding: 12px;
      box-shadow: -4px 0 8px rgba(0,0,0,0.08);
      z-index: 1150;
      overflow: auto;
    }
    #sideOrderPanel h4 { margin-top: 0; }
    #sideOrderPanel .order-item { 
      margin-bottom: 8px; 
      border-bottom: 1px dashed #eee; 
      padding-bottom: 6px;
      display: flex; 
      flex-direction: column;
      align-items: stretch; 
      text-align: left;
    }
    #sideOrderPanel .remove-btn {
      background: red; color: white; border: none; border-radius: 50%;
      width: 20px; height: 20px; font-weight: bold;
      cursor: pointer;
      font-size: 14px;
      line-height: 18px;
      text-align: center;
    }
    .quantity-selector {
      display: inline-flex;
      align-items: center;
      border: 2px solid #27ae60; 
      border-radius: 20px;
      padding: 5px 15px;
      background: #fff;
      font-size: 20px;
      font-weight: bold;
      gap: 20px;
      margin-top: 8px;
    }
    .quantity-btn {
      background: none;
      color: #333;
      border: none;
      font-size: 24px;
      cursor: pointer;
      width: 32px;
      height: 32px;
      font-family: inherit;
      user-select: none;
    }
    .quantity-value {
      width: 32px; text-align: center;
      font-size: 20px;
      border: none; background: none;
    }

    #doneBtn, #placeOrderBtn {
      position: fixed;
      right: 20px;
      bottom: 60px;
      background: #1ABC9C;
      color: white;
      padding: 12px 18px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      display: none;
      z-index: 1200;
      gap: 10px;
      margin-bottom: 10px;
    }
    #placeOrderBtn { bottom: 20px; }
    #orderSummary {
      position: fixed;
      right: 20px;
      bottom: 100px;
      background: #1ABC9C;
      padding: 10px 15px;
      border-radius: 6px;
      color: #333;
      font-weight: bold;
      display: none;
      z-index: 1200;
    }
  </style>
</head>
<body>

  <!-- Sidebar Navigation -->
  <div class="sidebar">
    <h2 data-translate="menu">Menu</h2>
    <button onclick="navigateTo('home.html', this)">Price Prediction</button>
    <button onclick="navigateTo('disease.html', this)">Disease Prediction</button>
    <button onclick="navigateTo('Market place.html', this)">Market Place</button>
    <button onclick="navigateTo('Scheme.html', this)">Schemes</button>
    <button onclick="navigateTo('profile.html', this)">Profile</button>
  </div>

  <!-- Main Content -->
  <div class="content">
    <header>ðŸŒ¾ Farmers Marketplace ðŸŒ¿</header>

    <div id="choice" class="center">
      <button onclick="showBuyer()">I am a Buyer</button>
      <button onclick="showSeller()">I am a Seller</button>
    </div>

    <div id="buyerPage" class="hidden">
      <button class="back-btn" onclick="goBack()">â¬… Back</button>
      <div class="top-bar">
        <div style="position:relative;">
          <button id="categoriesBtn" onclick="toggleCategories()">Categories</button>
          <div id="categoriesDropdown"></div>
        </div>
        <div style="position:relative;">
          <button id="ordersBtn" onclick="toggleOrders()">My Orders</button>
          <div id="ordersDropdown"></div>
        </div>
      </div>
      <input type="text" class="search-bar" placeholder="Search..." oninput="searchProducts(this.value)">
      <div id="productGrid" class="product-grid"></div>
    </div>

    <div id="sellerPage" class="hidden seller-container">
      <button class="back-btn" onclick="goBack()">â¬… Back</button> <br>
      <button class="plus-btn" onclick="openForm()">+</button>
      <div id="sellerListings" class="seller-listings"></div>
      <div id="formContainer" class="hidden">
        <div class="form-popup">
          <h3>List a Product</h3>
          <input type="file" id="image" accept="image/*" required>
          <input type="text" id="region" placeholder="Enter product name" required>
          <select id="category">
            <option value="">Select Category</option>
            <option>Cereals</option><option>Pulses</option><option>Vegetables</option><option>Fruits</option>
          </select>
          <input type="text" id="quantity" placeholder="Enter quantity" required>
          <input type="number" id="cost" placeholder="Enter cost (â‚¹)" required>
          <input type="text" id="pincode" placeholder="Enter pin code" required>
          <div class="footer-text">Cash on delivery only</div>
          <button onclick="listProduct()">List</button>
        </div>
      </div>
    </div>

    <div id="sideOrderPanel" aria-hidden="true">
      <h4>My Orders</h4>
      <div id="sideOrdersList"></div>
      <div id="sideOrdersFooter" style="margin-top:10px;"></div>
      <div style="margin-top:18px;">
        <label for="pickupTime" style="font-weight:600; font-size:16px;">Pickup Timing:</label>
        <input type="datetime-local" id="pickupTime" style="margin-top:4px; padding:4px 10px; font-size:16px; border-radius:6px; border:1px solid #ccc;" onchange="setPickupTime(this.value)">
      </div>
    </div>

    <div id="successPopup">âœ… Product Listed Successfully!</div>
    <div id="centerConfirmPopup">âœ… Order Confirmed!</div>
    <div id="orderSummary"></div>
    <button id="doneBtn" onclick="showOrderSummary()">Done</button>
    <button id="placeOrderBtn" onclick="placeOrder()">Place Order</button>
  </div>

<script>
  let products = [];
  let orders = [];
  let selectedPickupTime = "";

  // Show Buyer or Seller pages
  function showBuyer(){ 
    document.getElementById("choice").classList.add("hidden"); 
    document.getElementById("buyerPage").classList.remove("hidden"); 
    renderProducts(products); 
  }
  function showSeller(){ 
    document.getElementById("choice").classList.add("hidden"); 
    document.getElementById("sellerPage").classList.remove("hidden"); 
  }
  function goBack(){ 
    document.getElementById("buyerPage").classList.add("hidden"); 
    document.getElementById("sellerPage").classList.add("hidden"); 
    document.getElementById("choice").classList.remove("hidden"); 
    hideCategoriesDropdown(); hideOrdersDropdown(); hideSideOrders();
    document.getElementById("doneBtn").style.display="none";
    document.getElementById("placeOrderBtn").style.display="none";
    document.getElementById("orderSummary").style.display="none";
  }

  // Render products
  function renderProducts(list){
    const grid = document.getElementById("productGrid"); 
    grid.innerHTML = "";
    list.forEach((p, index)=>{
      grid.innerHTML += `
        <div class="product-card">
          <img src="${p.img}" alt="${p.name}">
          <h4>${p.name}</h4>
          <div>Quantity: ${p.qty || "N/A"}</div>
          <div>Category: ${p.category}</div>
          <div class="price">â‚¹${p.price}</div>
          <button onclick="addToOrder(${index})">Add to Order</button>
        </div>`;
    });
  }
  function searchProducts(q){ 
    renderProducts(products.filter(p=> p.name.toLowerCase().includes(q.toLowerCase()))); 
  }

  // Categories filter
  function toggleCategories(){ 
    const d=document.getElementById("categoriesDropdown"); 
    if(d.style.display==="block"){ hideCategoriesDropdown(); return; }
    const fixed = ["Cereals","Pulses","Vegetables","Fruits"];
    const dynamic = Array.from(new Set(products.map(p=>p.category).filter(Boolean)));
    const all = Array.from(new Set(["All", ...fixed, ...dynamic]));
    d.innerHTML = all.map(c=>`<button onclick="filterByCategory('${c}', this)">${c}</button>`).join("");
    d.style.display="block";
  }
  function filterByCategory(c, btn){
    document.querySelectorAll("#categoriesDropdown button").forEach(b=>b.classList.remove("selected"));
    btn.classList.add("selected");
    if(c==="All"){ renderProducts(products); } 
    else { renderProducts(products.filter(p=> p.category===c)); }
    hideCategoriesDropdown();
  }
  function hideCategoriesDropdown(){ 
    document.getElementById("categoriesDropdown").style.display="none"; 
  }

  // Orders
  function toggleOrders(){ 
    const d=document.getElementById("ordersDropdown"); 
    if(d.style.display==="block"){ hideOrdersDropdown(); return; }
    showOrdersDropdown(); 
    d.style.display = "block";
  }
  function showOrdersDropdown(){
    const d = document.getElementById("ordersDropdown");
    if(orders.length === 0){ 
      d.innerHTML = "<p style='margin:6px 0;'>No items yet</p>"; 
      document.getElementById("doneBtn").style.display="none";
      document.getElementById("placeOrderBtn").style.display="none";
      return; 
    }
    let html = orders.map((p,i)=>`<p style="margin:6px 0">${p.name}-${p.price} 
      <button style="background:red;color:white;border:none;border-radius:4px;margin-left:6px;" onclick="removeOrder(${i})">x</button>
    </p>`).join("");
    d.innerHTML = html;
    document.getElementById("doneBtn").style.display="block"; 
    document.getElementById("placeOrderBtn").style.display="none";
  }

  function addToOrder(i) {
    const prod = {...products[i], quantity: 1};
    orders.push(prod);
    showOrdersDropdown();
    updateSideOrders();
  }

  function removeOrder(index){
    orders.splice(index,1);
    showOrdersDropdown();
    updateSideOrders();
  }

  function updateSideOrders(){
    const side = document.getElementById("sideOrderPanel");
    const list = document.getElementById("sideOrdersList");
    const footer = document.getElementById("sideOrdersFooter");
    if(orders.length === 0){
      side.style.display = "none";
      list.innerHTML = "";
      footer.innerHTML = "";
      return;
    }
    list.innerHTML = orders.map((p, i) => `
      <div class="order-item">
        <div style="display:flex;align-items:center;justify-content:space-between;">
          <span>${p.name} - â‚¹${p.price}</span>
          <button class="remove-btn" onclick="removeOrder(${i})" style="margin-bottom:0;">x</button>
        </div>
        <span class="quantity-selector">
          <button class="quantity-btn" onclick="changeOrderQty(${i}, -1)">â€“</button>
          <span class="quantity-value" id="qty-${i}">${p.quantity}</span>
          <button class="quantity-btn" onclick="changeOrderQty(${i}, 1)">+</button>
        </span>
      </div>
    `).join("");

    let total = orders.reduce((s,p) => s + p.price * p.quantity, 0);
    let delivery = new Date(Date.now() + 60 * 60 * 1000).toLocaleTimeString();
    footer.innerHTML = `<div style="margin-top:8px;"><b>Total:</b> â‚¹${total}</div>
                        <div style="margin-top:6px;">Estimated Delivery: ${delivery}</div>`;
    side.style.display = "block";
    document.getElementById("pickupTime").value = selectedPickupTime;
  }

  function changeOrderQty(index, delta) {
    if (!orders[index]) return;
    orders[index].quantity = Math.max(1, orders[index].quantity + delta);
    document.getElementById("qty-" + index).textContent = orders[index].quantity;
    updateSideOrders();
  }

  function setPickupTime(val) {
    selectedPickupTime = val;
  }

  function showOrderSummary(){
    if(orders.length===0) return;
    let total = orders.reduce((s,p)=>s+p.price * p.quantity,0);
    let delivery = new Date(Date.now()+60*60*1000).toLocaleTimeString();
    const summary = document.getElementById("orderSummary");
    summary.innerHTML = `Total: â‚¹${total} <br>
        Pickup Time: ${selectedPickupTime ? new Date(selectedPickupTime).toLocaleString() : "Not set"} <br>
        Delivery: ${delivery}`;
    summary.style.display = "block";
    document.getElementById("placeOrderBtn").style.display = "block";
  }

  function placeOrder(){
    const centerPopup = document.getElementById("centerConfirmPopup");
    centerPopup.innerHTML = "âœ… Order Confirmed!";
    centerPopup.style.display="block";
    setTimeout(()=>{ centerPopup.style.display="none"; },800);
    orders = [];
    showOrdersDropdown();
    updateSideOrders();
    document.getElementById("orderSummary").style.display="none";
    document.getElementById("doneBtn").style.display="none";
    document.getElementById("placeOrderBtn").style.display="none";
  }

  function hideOrdersDropdown(){ 
    document.getElementById("ordersDropdown").style.display="none"; 
  }
  function hideSideOrders(){ 
    document.getElementById("sideOrderPanel").style.display = "none"; 
  }

  function openForm(){ 
    document.getElementById("formContainer").classList.remove("hidden"); 
  }
  function listProduct(){
    const region=document.getElementById("region").value,
          category=document.getElementById("category").value,
          cost=document.getElementById("cost").value,
          quantity=document.getElementById("quantity").value,
          pincode=document.getElementById("pincode").value,
          image=document.getElementById("image").files[0];
    if(!region||!category||!cost||!quantity||!pincode||!image){ 
      alert("Please fill all details!"); return; 
    }
    const reader=new FileReader(); 
    reader.onload=function(e){
      document.getElementById("sellerListings").innerHTML+=`
        <div class="seller-card">
          <img src="${e.target.result}" style="width:100%;height:80px;object-fit:cover">
          <p>${region}</p>
          <p>${category}</p>
          <p>â‚¹${cost}</p>
          <p>${quantity} units</p>
          <p>${pincode}</p>
        </div>`;
      products.push({
        name: region,
        price: parseInt(cost),
        category: category,
        qty: quantity,
        img: e.target.result
      });
      document.getElementById("region").value="";
      document.getElementById("category").value="";
      document.getElementById("cost").value="";
      document.getElementById("quantity").value="";
      document.getElementById("pincode").value="";
      document.getElementById("image").value="";
      document.getElementById("formContainer").classList.add("hidden");
    }
    reader.readAsDataURL(image);
  }
  function navigateTo(page, btn){
    document.querySelectorAll('.sidebar button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    window.location.href = page;
  }
</script>
</html>
